<?php
// src/Site/TourneurFraiseurBundle/Repository/CandidatRepository.php

namespace Site\TourneurFraiseurBundle\Repository;

/**
 * CandidatRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class CandidatRepository extends \Doctrine\ORM\EntityRepository
{
	function getDernierCandidat(){
		$qb=$this->createQueryBuilder('c');
		$qb->orderBy('c.datecreation','DESC')
			->setMaxResults(5);
		
		return $qb->getQuery()->getResult();
	}
	
	function getCVThequeTrie($dept)
	{
		$qb = $this->createQueryBuilder('a');
		$qb ->where('a.idSite = :id')
			->setParameter('id', 15)
			->orderBy('a.nom','ASC');
			
		if($dept != null){
			$qb->join('a.codePostal','v')
				->join('v.departement','d')
				->andWhere('d.id = :dept')
				->setParameter('dept', $dept);
		}

		return $qb
				->getQuery()
				->getResult();
	}
	
}
