<?php
// src/Site/TourneurFraiseurBundle/Repository/CandidatRepository.php

namespace Site\TourneurFraiseurBundle\Repository;

/**
 * CandidatRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class CandidatRepository extends \Doctrine\ORM\EntityRepository
{
	function getDernierCandidat(){
		$qb=$this->createQueryBuilder('c');
		$qb->orderBy('c.datecreation','DESC')
			->setMaxResults(5);
		
		return $qb->getQuery()->getResult();
	}
	
	function getCVThequeTrie($dept)
	{
		$qb = $this->createQueryBuilder('a');
		$qb ->select('a,count(annonce.id) AS HIDDEN nb')
			->orderBy('a.nom','ASC')
			->join('a.annonce','annonce')
			->join('annonce.site','s')
			->where('s.idSiteemploi = :site')
			->setParameter('site', 15)
			->groupBy('annonce.id')
			->orderBy('nb','DESC');
			
		if($dept != null){
			$qb->join('a.codePostal','v')
				->join('v.departement','d')
				->andWhere('d.id = :dept')
				->setParameter('dept', $dept);
		}

		return $qb
				->getQuery()
				->getResult();
	}
	
	function getCandidatFonction($candidat,$fonction){
		$qb = $this->createQueryBuilder('c');
		$qb 
			->where('c.id = :id')
			->setParameter('id', $candidat)
			->join('c.fonction','f')
			->andWhere('f.id = :fonction')
			->setParameter('fonction', $fonction)	
			;
		
		
		return $qb
				->getQuery()
				->getResult();
	}
	
}
